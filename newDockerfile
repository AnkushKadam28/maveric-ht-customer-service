pipeline {
    agent any

    environment {
        DOCKERFILE_PATH = 'src/main/docker/Dockerfile.jvm'
        IMAGE_NAME = 'docker:latest'
    }

    stages {
        stage('Build Docker Image with Containerd') {
            steps {
                script {
                    // Execute Containerd commands to build the Docker image
                    sh """
                        containerd --namespace default --address /run/containerd/containerd.sock \
                        image import -i $IMAGE_NAME --snapshotter overlayfs \
                        --stargz-path /tmp/myimage.stargz < ${DOCKERFILE_PATH}
                    """
                }
            }
        }
    }
}
